/*!
 * Copyright (c) 2020, 2024, Oracle and/or its affiliates. All rights reserved.
 */
!function(e,t,n,i,a,o,r,s,l){"use strict";const u="data-rownum",c="data-id",g="["+c+"]";r.templateReportRegionInit=function(r,d){let p,f=null,h=null,m=!1;const w=i("#"+r.regionStaticId+"_"+r.regionType);function b(e){return(e&&e.length?e:w).find('[role="grid"]').filter((function(){return 0===i(this).closest(g).length})).length>0}function R(t){let n=v.width(),i=v.height();w.data("apexTableModelView")&&(r._isTemplateReport||e.setOuterWidth(w,n),r.hasSize&&e.setOuterHeight(w,i),t||w.tableModelView("resize"))}function I(e){const t=w.tableModelView("getPageInfo")||{};let n=null;i.each(w.find(g),(function(e,a){const o=i(a);if(!t.scrollOffset)return n=o.attr(u),!1;if(o.offset().top-(t.rowHeight/2||0)>=t.scrollOffset)return n=o.attr(u),!1}));const o={ajaxIdentifier:e.ajaxIdentifier,id:e.regionId,pageChange:{offset:t.pageOffset,count:t.pageSize,firstDisplayRow:n}};a.plugin({regions:[o]})}function x(e){let t,n=i(e),a=n.find(g).first();return t=b(n)?a.parent().parent():a.parent(),t&&t.length||(t=n.children().filter((function(){return!["SCRIPT","STYLE"].includes(this.tagName)})).first()),t}function C(){i("button[data-menu^='tc_menu_a']",w).each((function(){const t=e.escapeCSS(this.getAttribute("data-menu"));i(`div.a-Menu[id=${t}]`).remove(),i(`#${t}`).menu()})),w.removeClass("is-loading")}s.info("Init template report region: ",r),d&&d.firstDisplayedRow>1&&(r.firstDisplayedRow=d.firstDisplayedRow-1),r.lazyLoading?r.bodyTemplate&&(r.getDataObjectCallback=x):(r.preRendered?(r.getDataObjectCallback=x,f=d.values&&r.firstDisplayedRow>0?d.values.slice(0,d.firstDisplayedRow-1):[],i.each(x(w).children(),(function(e,t){const n=b()?i(t).find(g):i(t),a=i(t).prop("outerHTML");n&&n.length&&n.is(g)&&(r.modelOptions.identityField?f.push([n.attr(c),a]):f.push([a]))})),d.values&&(f=r.firstDisplayedRow>0?f.concat(d.values.slice(d.firstDisplayedRow-1)):f.concat(d.values)),0===f.length&&(f=null)):f=d.values,d.totalRows&&(h=d.totalRows),p=d.moreData);const T=l.create(r.modelName,i.extend({},r.modelOptions,{shape:"table",recordIsArray:!0,fields:r.columns[0],regionId:r.regionId,ajaxIdentifier:r.ajaxIdentifier,regionData:{ajaxColumns:r.ajaxColumns,ajaxActions:r.ajaxActions,ajaxActionMenus:r.ajaxActionMenus},pageItemsToSubmit:r.itemsToSubmit}),f,h,p);h=f=null,p=void 0;const v=w.parent();r.hasSize&&v.css("height",r.reportHeight||v.height()),R(!0),r.entityTitlePlural?r.noDataMessage=o.formatMessage("APEX.NO_DATA_FOUND_ENTITY",r.entityTitlePlural):void 0===r.noDataMessage&&(r.noDataMessage=o.getMessage("APEX.IG.NO_DATA_FOUND"));let S=r.pagination;if(S.scroll&&(S.virtual=void 0!==S.virtual?S.virtual:r.modelOptions.hasTotalRecords),S.savePaginationToServer)if(r.pagination.scroll){const t=i(window);t.on("scroll",e.debounce((function(){w.is(":visible")&&t.scrollTop()>=w.offset().top-window.innerHeight&&t.scrollTop()<=w.offset().top+w.height()&&I(r)}),600)),r.pageChange=C}else r.pageChange=function(){C(),m&&I(r),m=!0};if(r.fixedRowHeight=!1,w.on("tablemodelviewselectionchange",(()=>{w.trigger("apexselectionchange",[{selectedValues:w.tableModelView("getSelectedValues")}])})),w.on("tablemodelviewcurrentitemchange",(()=>{w.trigger("apexcurrentrowchange",[{currentValue:w.tableModelView("getCurrentItem")?.attr(c)}])})),w.tableModelView(r),r._isTemplateReport){new ResizeObserver(e.debounce((function(){R()}),100)).observe(w.parent()[0])}else t.onElementResize(w.parent()[0],(()=>{R()}));t.onVisibilityChange(w[0],(e=>{e&&(r._isTemplateReport||t.updateResizeSensors(v[0]),R())}));const D=["focus","getSelectedValues","selectAll","setSelectedValues","getSelection","setSelection","firstPage","lastPage","nextPage","previousPage"],V=[...D,"getCurrentItem","setCurrentItem","getCurrentItemValue","setCurrentItemValue","getRecords","getModel","getSelectedRecords","setSelectedRecords","getPageInfo","gotoPage","loadMore"];n.create(r.regionStaticId,(function(e){const t="tableModelView",n=w[t]("instance");i.extend(e,{type:r.regionType,parentRegionId:r.parentRegionStaticId,filterRegionId:r.filterRegionId,refresh:function(){return new Promise((e=>{const t=T.subscribe({onChange:n=>{"refresh"===n&&(T.unSubscribe(t),e())}});T.clearData()||(T.unSubscribe(t),e())}))}}),r._isTemplateReport||(e.widgetName=t,e.widget=function(){return w},e.refreshView=function(){n.refresh()}),(r._isTemplateReport?D:V).forEach((t=>{e[t]=n[t].bind(n)})),r._isTemplateReport&&(e.getCurrentRow=n.getCurrentItem.bind(n),e.setCurrentRow=n.setCurrentItem.bind(n),e.getCurrentRowValue=n.getCurrentItemValue.bind(n),e.setCurrentRowValue=n.setCurrentItemValue.bind(n))}))}}(apex.util,apex.widget.util,apex.region,apex.jQuery,apex.server,apex.lang,apex.widget,apex.debug,apex.model);